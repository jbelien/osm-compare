{% extends "layout.njk" %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/openlayers/4.2.0/ol.css" integrity="sha256-rQq4Fxpq3LlPQ8yP11i6Z2lAo82b6ACDgd35CKyNEBw=" crossorigin="anonymous">
{% endblock %}

{% block content %}
<div class="container">
  <h2>3 - Compare</h2>
  <hr>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col">
      <h3>{{file}}</h3>
      <div id="map1"></div>
    </div>
    <div class="col">
      <h3>OpenStreetMap</h3>
      <div id="map2"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/openlayers/4.2.0/ol.js" integrity="sha256-AS3nJgIE4+tPLihbjC2HgphwH1ofrA+7JaP4WmPL+9Q=" crossorigin="anonymous"></script>
<script>
  (function(){
    var areaLayer = new ol.layer.Vector({
      source: new ol.source.Vector(),
      style: function(feature) {
        return new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: "blue",
            lineDash: [10],
            width: 3
          }),
          fill: false
        });
      }
    });
    var vectorLayer1 = new ol.layer.Vector({
      source: new ol.source.Vector()
    });
    var vectorLayer2 = new ol.layer.Vector({
      source: new ol.source.Vector()
    });

    var view = new ol.View({
      center: ol.proj.fromLonLat([37.41, 8.82]),
      zoom: 4
    });

    var map1 = new ol.Map({
      controls: ol.control.defaults({attribution: false}).extend([ new ol.control.Attribution({collapsible: false}) ]),
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        }),
        areaLayer,
        vectorLayer1
      ],
      target: "map1",
      view: view
    });

    var map2 = new ol.Map({
      controls: ol.control.defaults({attribution: false}).extend([ new ol.control.Attribution({collapsible: false}) ]),
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        }),
        areaLayer,
        vectorLayer2
      ],
      target: "map2",
      view: view
    });

    areaLayer.getSource().addFeature((new ol.format.GeoJSON()).readFeature({{ area | dump | safe }}, { featureProjection: view.getProjection() }));

    //vectorSource1.addFeature((new ol.format.GeoJSON()).readFeatures({{ geojson | dump | safe }}, { featureProjection: view.getProjection() }));
    //vectorSource2.addFeature((new ol.format.GeoJSON()).readFeatures({{ osm | dump | safe }}, { featureProjection: view.getProjection() }));

    var json = {{ geojson | dump | safe }};
    json.features.forEach(function(feature) {
      vectorLayer1.getSource().addFeature((new ol.format.GeoJSON()).readFeature(feature, { featureProjection: view.getProjection() }));
    });

    var osm = {{ osm | dump | safe }};
    osm.features.forEach(function(feature) {
      vectorLayer2.getSource().addFeature((new ol.format.GeoJSON()).readFeature(feature, { featureProjection: view.getProjection() }));
    });

    view.fit(areaLayer.getSource().getExtent());
  })();
</script>
{% endblock %}
